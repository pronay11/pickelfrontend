{"version":3,"file":"index.js","sources":["../src/utils/initBkash.ts","../src/utils/loadScript.ts","../src/utils/loadDeps.ts","../src/index.tsx"],"sourcesContent":["/* eslint-disable no-undef */\r\n//@ts-nocheck\r\ndeclare global {\r\n\tinterface Window {\r\n\t\tpaymentID: string;\r\n\t}\r\n}\r\n\r\nimport { ICreatePaymentResponse, IExecutePaymentResponse, IPaymentRequest } from './interfaces';\r\n\r\nexport const initBkash = (\r\n\tamount: string | number,\r\n\tcreatePaymentURL: string,\r\n\texecutePaymentURL: string,\r\n\tonSuccess: (data: IExecutePaymentResponse) => void,\r\n\tonClose: () => void,\r\n\tadditionalHeaders: Record<string, string> = {}\r\n) => {\r\n\tconst config = {\r\n\t\tpaymentMode: 'checkout',\r\n\t\tpaymentRequest: {\r\n\t\t\tamount: String(amount),\r\n\t\t\tintent: 'sale',\r\n\t\t},\r\n\r\n\t\tcreateRequest: async function (request: IPaymentRequest) {\r\n\t\t\tconst data = await post<ICreatePaymentResponse>(createPaymentURL, request, additionalHeaders);\r\n\t\t\tif (data && data.paymentID !== null) {\r\n\t\t\t\twindow.paymentID = data.paymentID;\r\n\t\t\t\tbKash.create().onSuccess(data);\r\n\t\t\t} else {\r\n\t\t\t\tbKash.create().onError();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texecuteRequestOnAuthorization: async function () {\r\n\t\t\tconst data = await post<IExecutePaymentResponse>(executePaymentURL, { paymentID: window.paymentID }, additionalHeaders);\r\n\t\t\tif (data && data.paymentID !== null) {\r\n\t\t\t\tonSuccess(data);\r\n\t\t\t} else {\r\n\t\t\t\tbKash.execute().onError();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonClose: () => callBack(false),\r\n\t};\r\n\tbKash.init(config);\r\n};\r\nexport const createBkashButton = (): void => {\r\n\tconst button = document.createElement('button');\r\n\tbutton.style.display = 'none';\r\n\tbutton.id = 'bKash_button';\r\n\tdocument.querySelector('body').appendChild(button);\r\n};\r\nexport const triggerBkash = (): void => {\r\n\tconst createdButton = document.querySelector('#bKash_button')! as HTMLElement;\r\n\tcreatedButton.click();\r\n\tcreatedButton.remove();\r\n};\r\n\r\nasync function post<T>(url: string, body: Record<string, string>, additionalHeaders: Record<string, string> = {}): Promise<T> {\r\n\treturn await fetch(url, {\r\n\t\theaders: {\r\n\t\t\t'content-type': 'application/json',\r\n\t\t\t...additionalHeaders,\r\n\t\t},\r\n\t\tmethod: 'POST',\r\n\t\tbody: JSON.stringify(body),\r\n\t}).then((r) => r.json());\r\n}\r\n","export const loadScript = (url: string, id: string): Promise<void> => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst script = document.createElement('script');\r\n\t\tscript.onload = resolve.bind(id);\r\n\t\tscript.src = url;\r\n\t\tscript.id = id;\r\n\t\tscript.onerror = reject;\r\n\t\tdocument.head.appendChild(script);\r\n\t});\r\n};\r\n","import { createBkashButton } from './initBkash';\nimport { loadScript } from './loadScript';\n\nexport const loadDeps = async (bkashScriptURL: string) => {\n\tif (!document.querySelector('#jquery')) {\n\t\tawait loadScript('https://code.jquery.com/jquery-3.3.1.min.js', 'jquery');\n\t}\n\tcreateBkashButton();\n\n\tif (!document.querySelector('#bkashScript')) {\n\t\tawait loadScript(bkashScriptURL, 'bkashScript');\n\t}\n};\n","import React, { ReactElement, useEffect, useState, FC, cloneElement } from 'react';\r\nimport { initBkash, triggerBkash, loadDeps, IProps } from './utils';\r\n\r\nconst BkashButton: FC<IProps> = (props): JSX.Element | null => {\r\n\tconst [isLoaded, setLoaded] = useState(false);\r\n\tconst {\r\n\t\tonSuccess,\r\n\t\tonClose,\r\n\t\tchildren,\r\n\t\tconfig: { amount, bkashScriptURL, createPaymentURL, executePaymentURL, additionalHeaders },\r\n\t} = props;\r\n\r\n\tuseEffect(() => {\r\n\t\tasync function main() {\r\n\t\t\tif (!isLoaded) {\r\n\t\t\t\tawait loadDeps(bkashScriptURL);\r\n\t\t\t\tinitBkash(amount, createPaymentURL, executePaymentURL, onSuccess, onClose, additionalHeaders);\r\n\t\t\t\tsetLoaded(true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tmain();\r\n\t}, []);\r\n\r\n\tif (isLoaded) {\r\n\t\treturn <div>{cloneElement(children as ReactElement, { onClick: triggerBkash })}</div>;\r\n\t}\r\n\r\n\treturn null;\r\n};\r\n\r\nexport default BkashButton;\r\nexport * from './utils';\r\n"],"names":["useState","useEffect","React","cloneElement"],"mappings":"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"}